# Maintainers

This file documents release and maintenance workflows for this repository.

## Release automation (Release Please)

- Workflow: `.github/workflows/release-please.yml`
- Trigger: manual run via `workflow_dispatch` (re-enable CI-triggered runs after history cleanup)
- Behavior: opens or updates a release PR and manages `CHANGELOG.md`
- Merge: merging the release PR creates the Git tag and GitHub Release
- Config: `release-please-config.json` and `.release-please-manifest.json` (tags and release titles are `vX.Y.Z`)


## Conventional Commits and PR titles

- Main branch uses a PR title lint (see `.github/workflows/semantic-pr.yml`).
- Squash-merge should use the PR title for the commit message to keep history linear.
- Maintainers may use any commit messages on feature branches; only the PR title must be Conventional Commits compliant.
- When time allows, keep commit messages conventional for clarity, but it is not required for merge.

### Dependabot guidance

- Dependabot PR titles are configured to use a Conventional Commit prefix (see `.github/dependabot.yml`).
- Maintainers must review dependency upgrades for breaking changes.
- If a dependency update is breaking, edit the PR title to include `!` (e.g., `chore(deps)!: bump react to v19`) or add a `BREAKING CHANGE:` note in the PR description.

## Release checklist


1. Ensure commit messages follow conventional commits:
   - `fix:` for patch releases
   - `feat:` for minor releases
   - `feat!:` or `BREAKING CHANGE:` for major releases
2. Verify `dist/` is up to date if any `src/` files changed since the last release:
   - run `npm run build:all`
   - if `dist/` changes, commit them to the release PR
   - CI also enforces this via the "Verify dist is up to date" step
3. Confirm CI is green on the release PR
4. Merge the release PR

## After merge

- Confirm the GitHub Release is published (not a draft)
- Verify the Marketplace listing reflects the new release tag/version

## Self-test workflows

The self-test workflows are used to validate the action's behavior against
controlled scenarios (no external traffic beyond the test runner). They run the
action in a matrix of scenarios, then download diagnostics artifacts and render
or validate detailed results. This is the fastest way to detect reducer
regressions and to verify the poller and post hook behave as expected.

### What they are

- Workflow files: `.github/workflows/self-test.yml` and `.github/workflows/realistic-test.yml`
- Generator: `scripts/generate-self-test.ts`
- Scenarios manifest: `scripts/scenarios.ts` (inputs) and `scripts/self-test-manifest.json` (generated)
- Scenario runner: `scripts/run-scenario.mjs`
- Validator: `scripts/validate-scenario.mjs`
- Diagnostics renderer: `scripts/render-diagnostics.mjs`

### How they are generated

- **Source of truth**: `scripts/scenarios.ts` defines all scenarios.
- Run `npm run generate:self-test` to regenerate:
  - `.github/workflows/self-test.yml`
  - `.github/workflows/realistic-test.yml` (only if realistic scenarios exist)
  - `scripts/self-test-manifest.json`
- Do not hand-edit the generated workflow files. The header in each workflow
  indicates they are auto-generated.

### When and why to run

- Use **Self-Test** (`self-test.yml`) for quick regression checks after changes
  to reducer logic, polling behavior, state handling, or output formatting.
- Use **Realistic Test** (`realistic-test.yml`) for longer-duration behavior or
  more production-like traffic patterns. This is intentionally separate to avoid
  slowing normal self-tests.
- Both workflows require `diagnostics: true` so they can download and analyze
  the diagnostics artifact. This is handled in the generator.

### Scenario selection

- Scenarios are toggled by workflow inputs (e.g., `run_core_5: true`).
- The generated workflows avoid inline `matrix.include` conditionals; toggles
  are checked by `scripts/check-scenario-enabled.mjs` at runtime.
- Diagnostics jobs skip when the paired scenario job is skipped.

### Notes

- Diagnostics artifacts include `state.json` and `poll-log.json`.
- If diagnostics are disabled in the action input, the self-test diagnostics
  jobs will not have artifacts to download and will fail.

## Notes

- `CHANGELOG.md` is generated by Release Please; avoid manual edits.
- If no release PR is created, confirm there are new conventional commits since the last tag.
- If Release Please fails to create a release, check tag rulesets for blocked tag creation or required status checks on tags.
